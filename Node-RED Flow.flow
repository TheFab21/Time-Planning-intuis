[
    {
        "id": "a3667737564f7de1",
        "type": "tab",
        "label": "Intuis connect - modèle",
        "disabled": false,
        "info": "Créé par Yann V. le 03/07/2024\nDernière mise a jour le 17/10/2024",
        "env": []
    },
    {
        "id": "41f803cead1de025",
        "type": "tab",
        "label": "Pilotage d'un radiateur",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e246d4c0642ebf59",
        "type": "tab",
        "label": "PIlotage Maison",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9794645f52fb9ea3",
        "type": "tab",
        "label": "Choix Planning",
        "disabled": false,
        "info": "Créé par Yann V. le 26/10/2024\r\nDernière mise a jour le 26/10/2024",
        "env": []
    },
    {
        "id": "d6bbc06b7594e446",
        "type": "tab",
        "label": "Modification Planning",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "52dda859303a9e7b",
        "type": "group",
        "z": "a3667737564f7de1",
        "name": "Récupération consommations ",
        "style": {
            "label": true
        },
        "nodes": [
            "9394b4d8841f3020",
            "b81624a10616b079",
            "60931de8d68a35ce",
            "2dac9207fbeacbca",
            "a7fa7bc3fdcf29cb",
            "f9c55eb38e63f82f",
            "691e2058bd943c46",
            "86ab6bcc5d67d931",
            "a7d0f6a353a3662f",
            "6ebb80f837312213",
            "b4f63770bf75b8f8",
            "4e160860baa3b54c",
            "114ba7eaf86e62aa",
            "4251a8325e8e8b29",
            "a6f06e0bc906d245",
            "97133803606ca367",
            "81207d0f20f0bb98",
            "61c1cfb61f2fc6d7",
            "226fa24d299ae9b3",
            "dc8e0139f295de61",
            "a73ca7cd4c888e15",
            "8150e047d1f38744",
            "cce8bc8481c49e3f"
        ],
        "x": 208,
        "y": 1599,
        "w": 1978,
        "h": 602
    },
    {
        "id": "1282f94706731784",
        "type": "group",
        "z": "a3667737564f7de1",
        "name": "Connexion préliminaire et récupération du token",
        "style": {
            "label": true
        },
        "nodes": [
            "e2b937effce815c2",
            "bcf1f2d3e7ca2f6a",
            "d5b71025d46d7744",
            "e9494dd20a419ed4",
            "7970da3f1675a226",
            "c0591c272dcd2777",
            "e8596f7f50bc05d8",
            "9cda1fcc120901f8",
            "43542daf578a4abb",
            "d854767798bcbdbf",
            "20d048608db5e5f5",
            "cf4a45632cea2d4d",
            "d3d173a4ed73ae1b"
        ],
        "x": 54,
        "y": 19,
        "w": 1617,
        "h": 322
    },
    {
        "id": "98f6607d60aa2973",
        "type": "group",
        "z": "41f803cead1de025",
        "name": "Passer une commande manuelle",
        "style": {
            "label": true
        },
        "nodes": [
            "b74d1c79eb438825",
            "0f7a3a023a851828",
            "1c0e78ec8f4d02d1",
            "d6c83735e0426191",
            "5e47cb03882a592c",
            "3f4d9b89505b1553",
            "54af251f4a00845b",
            "e99f423457b936f2",
            "7e1576fb3de95fcc",
            "d3f176bc44a4f1f9",
            "cbbb5d8f83363d0d",
            "cdb9f005b0bb8fe8",
            "e34dc2fbdc702765",
            "412c26a5faa47c42",
            "6793e71a455b8fa2",
            "de012e4ff5a1ae1a",
            "8b664aded0ec9d14",
            "a7f924b6389d4e84"
        ],
        "x": 54,
        "y": 119,
        "w": 1732,
        "h": 342
    },
    {
        "id": "087481a66b64a77c",
        "type": "group",
        "z": "e246d4c0642ebf59",
        "name": "Passer une commande manuelle",
        "style": {
            "label": true
        },
        "nodes": [
            "e16b1440f9976fc9",
            "40443890d8c3a7df",
            "5a3259d752e1efa7",
            "2ae8f33d83a59f91",
            "f1b88b07dab52fdf",
            "e0f695c83e952ca1",
            "f81677b3ca6fc19f",
            "e4342b0432a85d74",
            "96c2c3ef618edd31",
            "1267ba1a01763541",
            "be6618e22ddd3bef",
            "4a1da8ae2657e4f7",
            "481383c692b73536",
            "1374093addec990d",
            "63ac1cb9b44f06e5",
            "0cc9f801b39f1091"
        ],
        "x": 14,
        "y": 39,
        "w": 2012,
        "h": 202
    },
    {
        "id": "34336a48ec02f20d",
        "type": "group",
        "z": "9794645f52fb9ea3",
        "name": "Gestion planning chauffage",
        "style": {
            "label": true
        },
        "nodes": [
            "b33a88b5617f89db",
            "fd042da8b632b8ba",
            "5e86c83b1bb1779e",
            "92400dcaf72c9972",
            "9c57574987b74339",
            "d46ec09d2328154d",
            "3ad8fc0b452f4caa",
            "cbef5337b3ef3900",
            "471d58b1750acfda",
            "8c8d32bea621bca5",
            "959a7bbf9fba0ac5",
            "aa959dcd5b04c60c",
            "b110bb4941c45514",
            "d3b45a549e9deaf2",
            "cb09a5af2ccab0ae",
            "c540264fb7957f40"
        ],
        "x": 74,
        "y": 79,
        "w": 1372,
        "h": 242
    },
    {
        "id": "9c29a7df43721672",
        "type": "group",
        "z": "9794645f52fb9ea3",
        "name": "Aqcuitter ouverture fenêtre",
        "style": {
            "label": true
        },
        "nodes": [
            "58aee8436820190c",
            "1886bcc7c5f82bc7",
            "523fe5db69368821",
            "1afb356e7d76cfe1",
            "c2967d79d0c0fe33",
            "f24589a6a83bd139",
            "b57531cff61def7e",
            "949dc9bc2d0e3620",
            "d83a9dc535b855e4"
        ],
        "x": 34,
        "y": 319,
        "w": 1432,
        "h": 202
    },
    {
        "id": "b1d3bdb41aec61e1",
        "type": "group",
        "z": "a3667737564f7de1",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b755833499ad267f",
            "277531f0ba1a6ea6",
            "48e07c183d26c4ab",
            "a12d496db209d907",
            "129f966a0f29d92a",
            "6fec4dfe0584cfb1",
            "531528e158634dab",
            "5956786c32542061",
            "c7c208fc104c4168",
            "26145049672b8fdd",
            "27405eacdabc8f66",
            "d128cae9b0e2cf45",
            "54c0d284f7d3bfe2",
            "28e41332c9d268ea",
            "1bbf4fe2031bc85b",
            "94df6c8058225842",
            "ad3eee4825b32a4b",
            "88e74568be0f092f",
            "fdd2becf2693b61c",
            "fbbe4368ed84a6c5",
            "99756c9d699f3239",
            "6c100f59f14291b6",
            "6c450f5bbf3d4c57",
            "021da8220fbc5550",
            "9abd987efd9b7546",
            "4cfd2835fa680165",
            "3857c28b8862d75c",
            "b91c58d27d54e5df",
            "0deb5c6d429f4ece",
            "9b94f09b171de499",
            "e141e4595a4b6e16",
            "a0e9a9d273856931",
            "bd3c37e931f40b40",
            "b8d10f455c93a148",
            "065ca84be94dbe41",
            "97e9f286fc9a5665",
            "384661809c003895",
            "36b119d798d1f09b",
            "5f97191c87be0997",
            "1a04b2760fa9722a",
            "402ca2eec0855371",
            "9be212ece344d070",
            "08a6a40e838d1204",
            "c46e5b648a6e0f34",
            "974fedc8994ad3d2",
            "80d79edc3dcb6da3",
            "23ed5e92fa3e3e50",
            "91d09adf1e62589c",
            "ca91338c5feea99f",
            "b7cb94065f5b777b",
            "dc3f946f501c8c97",
            "746d36e6ebe9c381",
            "db2894edb0520171",
            "7ddd3550788087fb",
            "d817b31516902f7c",
            "ecd8e9857be09e06",
            "5094e59c96a7f35e"
        ],
        "x": 514,
        "y": 779,
        "w": 2332,
        "h": 742
    },
    {
        "id": "a7d0f6a353a3662f",
        "type": "group",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Définition début et fin de plage",
        "style": {
            "label": true
        },
        "nodes": [
            "4be6036fef820625",
            "4a9277d1a6e0e4af",
            "a4603047c37c9ccf",
            "d1306ed7f8aac635",
            "14c1c0ac41e49e9b",
            "636d70287e18f7aa",
            "379ab7ed0dd8c6fa",
            "8cf5423bdba99af6"
        ],
        "x": 234,
        "y": 1899,
        "w": 492,
        "h": 262
    },
    {
        "id": "8e811f3b7ee28fb8",
        "type": "junction",
        "z": "a3667737564f7de1",
        "x": 2300,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "553a4a33f70c2e19",
        "type": "server",
        "name": "Home Assistant",
        "version": 5,
        "addon": false,
        "rejectUnauthorizedCerts": false,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true,
        "heartbeat": false,
        "heartbeatInterval": 30,
        "areaSelector": "friendlyName",
        "deviceSelector": "friendlyName",
        "entitySelector": "friendlyName",
        "statusSeparator": ": ",
        "statusYear": "numeric",
        "statusMonth": "numeric",
        "statusDay": "numeric",
        "statusHourCycle": "h23",
        "statusTimeFormat": "h:m",
        "enableGlobalContextStore": true
    },
    {
        "id": "76054f9f12d4abf5",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Chambre d'amis",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "7cc9b3f8711a30db",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 0 Entrée",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "a8598d514ddc2992",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 2 Salle De Bain Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "5ae30bb9c36e011d",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 3 Chambre Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "8f644be40527e388",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 4 Couloir",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "4b11554c2980b712",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 5 Toilettes Visiteurs",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "cefcb67d6f9bc3da",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 6 Salon",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "26429a74f02e051a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 7 Salle à manger Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "9f31c4d71a2d6603",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 8 Salle de bains Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Salle de bains Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "303c882f16d16f3f",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 9 Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "69f87646ef646ef7",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consommation Room 11 salle de bains Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consommation salle de bains Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "6dbc88116a89ee2d",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Consomation Totale Chauffage",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Consomation Totale Chauffage"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "energy"
            },
            {
                "property": "unit_of_measurement",
                "value": "Wh"
            },
            {
                "property": "state_class",
                "value": "total_increasing"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "6c0257c5859242a5",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Mode Maison",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode Maison"
            },
            {
                "property": "icon",
                "value": "mdi:home"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "dfc0a292cf62b6bf",
        "type": "global-config",
        "name": "global-config",
        "env": [
            {
                "name": "username",
                "value": "toto@toto.com",
                "type": "str"
            },
            {
                "name": "password",
                "value": "__PWRD__",
                "type": "cred"
            },
            {
                "name": "ClientId",
                "value": "__PWRD__",
                "type": "cred"
            },
            {
                "name": "ClientSecret",
                "value": "__PWRD__",
                "type": "cred"
            }
        ]
    },
    {
        "id": "7b6075a0b55c0b0a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "Choix de la pièce",
        "version": 6,
        "entityType": "select",
        "haConfig": [
            {
                "property": "name",
                "value": "Choix de la pièce"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "config"
            },
            {
                "property": "options",
                "value": []
            }
        ],
        "resend": false,
        "debugEnabled": true
    },
    {
        "id": "70c64959424002d3",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "",
        "name": "liste_pieces_lens",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "liste_pieces_lens"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "b22e94a0f37cb076",
        "type": "mqtt-broker",
        "name": "MQTT",
        "broker": "192.168.1.X",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "f06b30da46b52b62",
        "type": "ha-device-config",
        "name": "Chauffage Entrée",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "cb9e582c8ad85e3e",
        "type": "ha-device-config",
        "name": "Chauffage Salle de bain Filles",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "458fbd4dd07d4ace",
        "type": "ha-device-config",
        "name": "Chauffage Couloir",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "38086847a02d49d8",
        "type": "ha-device-config",
        "name": "Chauffage Salon",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "c1e114bd73b7d75a",
        "type": "ha-device-config",
        "name": "Chauffage Salle de bain Parents",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "5b06070b1069a81f",
        "type": "ha-device-config",
        "name": "Chauffage Chambre Parents",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "be3a41c16e206ddc",
        "type": "ha-device-config",
        "name": "Chauffage Chambre d'amis",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "9150e51b3a4dd1ce",
        "type": "ha-device-config",
        "name": "Chauffage Chambre Filles",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "c3f23377a8977e23",
        "type": "ha-device-config",
        "name": "Chauffage Toilettes Visiteurs",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "bfa569038d17228e",
        "type": "ha-device-config",
        "name": "Chauffage Salle à Manger",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "7b0eafa81b222ac6",
        "type": "ha-device-config",
        "name": "Chauffage Cuisine",
        "hwVersion": "",
        "manufacturer": "Node-RED",
        "model": "",
        "swVersion": ""
    },
    {
        "id": "d95eedd859d8b664",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "f06b30da46b52b62",
        "name": "Température Entrée",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "20256badf8bcbdd4",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "f06b30da46b52b62",
        "name": "Température Consigne Entrée",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Consigne Entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "c77c14d53889e40e",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "f06b30da46b52b62",
        "name": "Fenêtre ouverte entrée",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "63d759f0f3c62f39",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "f06b30da46b52b62",
        "name": "Présence Entrée",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Présence Entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "1b0a97e23f63ce23",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "cb9e582c8ad85e3e",
        "name": "Température Salle De Bain Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "f76b635a04caa4af",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "f06b30da46b52b62",
        "name": "Mode fonctionnement Entrée",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Entrée"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "34586545d535ffd6",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "38086847a02d49d8",
        "name": "Température consigne Salon",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "bdeef0ef5efb5cfc",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "38086847a02d49d8",
        "name": "Fenetre ouverte Salon",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenetre ouverte Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "e5f43328f88b6b5d",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "38086847a02d49d8",
        "name": "Détection présence Salon",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "27398167c586ce1e",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "38086847a02d49d8",
        "name": "Mode fonctionnement Salon",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "67699c44de8c3d4e",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "38086847a02d49d8",
        "name": "Température Salon",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Salon"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "75bbd493b8d6cbaa",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "be3a41c16e206ddc",
        "name": "Température Chambre d'amis",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "e3d9b4aa57e5eb2a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "be3a41c16e206ddc",
        "name": "Mode fonctionnement Chambre d'amis",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "ae092069eb2baa8f",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "be3a41c16e206ddc",
        "name": "Température consigne Chambre d'amis",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "8aa169c5137457b4",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "be3a41c16e206ddc",
        "name": "Fenêtre ouverte Chambre d'amis",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "2ad54ae8b6a0245a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "be3a41c16e206ddc",
        "name": "Présence Chambre d'amis",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Présence Chambre d'amis"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "100a313af5f252be",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "cb9e582c8ad85e3e",
        "name": "Mode fonctionnement Salle De Bain Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "26eff76fdb9da3f4",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "cb9e582c8ad85e3e",
        "name": "Température consigne Salle De Bain Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "a2a9e05d6a0b1bca",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "cb9e582c8ad85e3e",
        "name": "Fenêtre ouverte Salle De Bain Filles",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "691179561d9ee5c9",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "cb9e582c8ad85e3e",
        "name": "Détection présence Salle De Bain Filles",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Salle De Bain Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "d175ed0f639479c1",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "9150e51b3a4dd1ce",
        "name": "Température Chambre Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "4c0cfd77ea47deab",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "9150e51b3a4dd1ce",
        "name": "Mode fonctionnement Chambre Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "98fab7910d34e3e3",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "9150e51b3a4dd1ce",
        "name": "Température consigne Chambre Filles",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "a25d545305d4095a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "9150e51b3a4dd1ce",
        "name": "Fenêtre ouverte Chambre Filles",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "eefcc8439123c565",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "9150e51b3a4dd1ce",
        "name": "Détection présence Chambre Filles",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Chambre Filles"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "cac4b902b0b84b30",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "458fbd4dd07d4ace",
        "name": "Température Couloir",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "e02b0c8d47c87143",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "458fbd4dd07d4ace",
        "name": "Mode fonctionnement Couloir",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "7f7134e1363ea26a",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "458fbd4dd07d4ace",
        "name": "Température consigne Couloir",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "49266288c9a62c61",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "458fbd4dd07d4ace",
        "name": "Fenêtre ouverte Couloir",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "049114a73bad92df",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "458fbd4dd07d4ace",
        "name": "Détection présence Couloir",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Couloir"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "5d53e3559196a609",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c3f23377a8977e23",
        "name": "Température Toilettes Visiteurs",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "3f9bcd622b07c830",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c3f23377a8977e23",
        "name": "Mode fonctionnement Toilettes Visiteurs",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "70c5705e81ca42f9",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c3f23377a8977e23",
        "name": "Température consigne Toilettes Visiteurs",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "1a58af4eea09dc8f",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c3f23377a8977e23",
        "name": "Fenêtre ouverte Toilettes Visiteurs",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "5954d5ae6da7f5db",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c3f23377a8977e23",
        "name": "Détection présence Toilettes Visiteurs",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Toilettes Visiteurs"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "c5105ec09fee0f89",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "bfa569038d17228e",
        "name": "Température Salle à manger Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "b7341bb3976a1367",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "bfa569038d17228e",
        "name": "Mode fonctionnement Température Salle à manger Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Température Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "4980b75f18d30d53",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "bfa569038d17228e",
        "name": "Température consigne Salle à manger Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "bb5a75a41d93970c",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "bfa569038d17228e",
        "name": "Fenêtre ouverte Salle à manger Cuisine",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "3773cd11fcbba532",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "bfa569038d17228e",
        "name": "Détection présence Salle à manger Cuisine",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Salle à manger Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "57fa319f12736dcf",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "7b0eafa81b222ac6",
        "name": "Température Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "53b332150a60514d",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c1e114bd73b7d75a",
        "name": "Température Salle De Bain Parents1",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Salle De Bain Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "424bb978f0f6efde",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "7b0eafa81b222ac6",
        "name": "Mode fonctionnement  Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement  Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "8db9b3e6402ad111",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "7b0eafa81b222ac6",
        "name": "Température consigne Cuisine",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "f7a037d0631128ed",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "7b0eafa81b222ac6",
        "name": "Fenêtre ouverte Cuisine",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "f879152761a06a35",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "7b0eafa81b222ac6",
        "name": "Détection présence Cuisine",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Cuisine"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "4b6005e3afbcf039",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c1e114bd73b7d75a",
        "name": "Mode fonctionnement Température Salle De Bain Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Température Salle De Bain Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "489d1dba2e55caf0",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c1e114bd73b7d75a",
        "name": "Température consigne Salle De Bain Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Salle De Bain Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "818cb23a81c12045",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c1e114bd73b7d75a",
        "name": "Fenêtre ouverte Salle De Bain Parents",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Salle De Bain Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "e2f6a2d30e54b216",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "c1e114bd73b7d75a",
        "name": "Détection présence Salle De Bain Parents",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Salle De Bain Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "2091f2ca728b6769",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "5b06070b1069a81f",
        "name": "Température Chambre Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température Chambre Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "b6ce81822e82d280",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "5b06070b1069a81f",
        "name": "Mode fonctionnement Température Chambre Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Mode fonctionnement Température Chambre Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "ccfe06e1f1664232",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "5b06070b1069a81f",
        "name": "Température consigne Chambre Parents",
        "version": 6,
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Température consigne Chambre Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "temperature"
            },
            {
                "property": "unit_of_measurement",
                "value": "°C"
            },
            {
                "property": "state_class",
                "value": "measurement"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "03657b3c18adda23",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "5b06070b1069a81f",
        "name": "Fenêtre ouverte Chambre Parents",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Fenêtre ouverte Chambre Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "window"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "015c87b01e4d648f",
        "type": "ha-entity-config",
        "server": "553a4a33f70c2e19",
        "deviceConfig": "5b06070b1069a81f",
        "name": "Détection présence Chambre Parents",
        "version": 6,
        "entityType": "binary_sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Détection présence Chambre Parents"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": "diagnostic"
            },
            {
                "property": "device_class",
                "value": "presence"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "e2b937effce815c2",
        "type": "http request",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Send refresh request",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/oauth2/token",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/x-www-form-urlencoded"
            }
        ],
        "x": 1060,
        "y": 160,
        "wires": [
            [
                "c0591c272dcd2777",
                "20d048608db5e5f5"
            ]
        ]
    },
    {
        "id": "bcf1f2d3e7ca2f6a",
        "type": "inject",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Start",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 140,
        "wires": [
            [
                "d5b71025d46d7744"
            ]
        ]
    },
    {
        "id": "d5b71025d46d7744",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Set param request refresh",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"client_id\": $env(\"ClientId\"),\t   \"user_prefix\":\"muller\",\t   \"client_secret\":$env(\"ClientSecret\"),\t   \"grant_type\":\"password\",\t   \"scope\":\"read_muller write_muller\",\t   \"password\":$env(\"password\"),\t   \"username\":$env(\"username\")\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 160,
        "wires": [
            [
                "e2b937effce815c2",
                "d3d173a4ed73ae1b"
            ]
        ]
    },
    {
        "id": "e9494dd20a419ed4",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Store tokens & delay",
        "rules": [
            {
                "t": "set",
                "p": "AccessToken",
                "pt": "global",
                "to": "payload.access_token",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "RefreshToken",
                "pt": "global",
                "to": "payload.refresh_token",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "payload.expires_in*1000-300000",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "status",
                "pt": "msg",
                "to": "OK",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "LastUpdateTime",
                "pt": "global",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1540,
        "y": 100,
        "wires": [
            [
                "9cda1fcc120901f8",
                "43542daf578a4abb"
            ]
        ]
    },
    {
        "id": "7970da3f1675a226",
        "type": "inject",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Stop",
        "props": [
            {
                "p": "reset",
                "v": "1",
                "vt": "num"
            },
            {
                "p": "status",
                "v": "STOP",
                "vt": "str"
            },
            {
                "p": "delay",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "9cda1fcc120901f8",
                "43542daf578a4abb",
                "d854767798bcbdbf"
            ]
        ]
    },
    {
        "id": "c0591c272dcd2777",
        "type": "switch",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "All ok ?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "access_token",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1300,
        "y": 160,
        "wires": [
            [
                "e9494dd20a419ed4"
            ],
            [
                "e8596f7f50bc05d8"
            ]
        ],
        "outputLabels": [
            "Response OK",
            "Error"
        ]
    },
    {
        "id": "e8596f7f50bc05d8",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Delay 1 hour on error",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "3600000",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "status",
                "pt": "msg",
                "to": "KO",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "NetatmoLastUpdateTime",
                "pt": "global",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1545,
        "y": 220,
        "wires": [
            [
                "9cda1fcc120901f8",
                "43542daf578a4abb"
            ]
        ]
    },
    {
        "id": "9cda1fcc120901f8",
        "type": "delay",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Refresh",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 465,
        "y": 160,
        "wires": [
            [
                "d5b71025d46d7744"
            ]
        ]
    },
    {
        "id": "43542daf578a4abb",
        "type": "delay",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 465,
        "y": 220,
        "wires": [
            [
                "d854767798bcbdbf"
            ]
        ]
    },
    {
        "id": "d854767798bcbdbf",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Next refresh in...",
        "func": "var d = new Date();\nvar n = d.getTime();\nvar start_time = global.get('LastUpdateTime')||0;\nvar duration = msg.delay/1000;\nvar elapsed_time = Math.round((n - start_time)/1000);\n\nvar remains = new Date(null);\nremains.setSeconds(duration - elapsed_time); // specify value for SECONDS here\nvar remains_h = remains.toISOString().substr(11, 8);\nif (msg.status == \"STOP\") {\n    node.status({});\n    msg.remains = \"00:00:00\";\n    msg.payload = 0;\n    return [null, msg];\n}\nif (elapsed_time < duration) {\n    node.status({fill:msg.status == \"OK\" ? \"blue\" : \"red\",shape:\"dot\", text:remains_h});\n    msg.remains = remains_h;\n    return [ msg, null ];\n}\n\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 300,
        "wires": [
            [
                "43542daf578a4abb"
            ],
            []
        ]
    },
    {
        "id": "0b708dd99a7fdecb",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 380,
        "wires": [
            [
                "4adc010b8102129c",
                "67ee9631179a9d0f"
            ]
        ]
    },
    {
        "id": "4adc010b8102129c",
        "type": "http request",
        "z": "a3667737564f7de1",
        "name": "Intuis homedata",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/homesdata",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "msg",
                "valueValue": "token"
            }
        ],
        "x": 1200,
        "y": 380,
        "wires": [
            [
                "58e86513b5620844",
                "19f864237658d884",
                "4eb030f7e69e9077",
                "a4df9b81c4858403",
                "7ffa5b33183e8288",
                "36a0cb2827584267",
                "c34398519cc2c89e",
                "7b3560f6d14a8682"
            ]
        ]
    },
    {
        "id": "311e5c9e03e928ce",
        "type": "inject",
        "z": "a3667737564f7de1",
        "name": "Get Intuis Data",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "0b708dd99a7fdecb",
                "4be6036fef820625",
                "4a9277d1a6e0e4af",
                "14c1c0ac41e49e9b",
                "636d70287e18f7aa"
            ]
        ]
    },
    {
        "id": "20d048608db5e5f5",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "contrôle authentification",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 60,
        "wires": []
    },
    {
        "id": "626dc70dbf75a137",
        "type": "http request",
        "z": "a3667737564f7de1",
        "name": "Intuis getconfig",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/syncapi/v1/getconfigs",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/x-www-form-urlencoded"
            }
        ],
        "x": 1200,
        "y": 700,
        "wires": [
            [
                "e011522b9b1daca4"
            ]
        ]
    },
    {
        "id": "e011522b9b1daca4",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Intuis getconfig",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1520,
        "y": 700,
        "wires": []
    },
    {
        "id": "58e86513b5620844",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Intuis homedata",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.body.homes[0]",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1520,
        "y": 360,
        "wires": []
    },
    {
        "id": "d9f2befaac2b726d",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "Set param get config 1",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"home_id\":$globalContext(\"home_id\")\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 700,
        "wires": [
            [
                "626dc70dbf75a137",
                "b755833499ad267f"
            ]
        ]
    },
    {
        "id": "9394b4d8841f3020",
        "type": "http request",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Intuis gethomemeasure",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/gethomemeasure",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1290,
        "y": 1760,
        "wires": [
            [
                "b81624a10616b079",
                "60931de8d68a35ce",
                "2dac9207fbeacbca",
                "f9c55eb38e63f82f",
                "61c1cfb61f2fc6d7",
                "81207d0f20f0bb98",
                "a6f06e0bc906d245",
                "97133803606ca367",
                "4251a8325e8e8b29",
                "226fa24d299ae9b3",
                "a73ca7cd4c888e15",
                "dc8e0139f295de61",
                "cce8bc8481c49e3f"
            ]
        ]
    },
    {
        "id": "b81624a10616b079",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Intuis gethomemeasure",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1610,
        "y": 1660,
        "wires": []
    },
    {
        "id": "60931de8d68a35ce",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 0 Entrée",
        "entityConfig": "7cc9b3f8711a30db",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1630,
        "y": 1780,
        "wires": [
            []
        ]
    },
    {
        "id": "2dac9207fbeacbca",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Calcul conso totale",
        "func": "try {\n    const rooms = msg.payload?.body?.home?.rooms;\n    if (!Array.isArray(rooms)) {\n        throw new Error(\"Liste de pièces non trouvée dans le payload.\");\n    }\n\n    const roomIndexes = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; \n\n    let consoTotal = 0;\n\n    for (let i of roomIndexes) {\n        const value = rooms[i]?.measures?.[0]?.value?.[0]?.[0];\n        if (typeof value !== 'number') {\n            node.warn(`Valeur manquante ou invalide pour la pièce ${i}`);\n            continue;\n        }\n        consoTotal += value;\n    }\n\n    msg.consototal = consoTotal;\n} catch (err) {\n    node.error(\"Erreur lors du calcul de la consommation : \" + err.message, msg);\n    msg.consototal = null;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 1720,
        "wires": [
            [
                "a7fa7bc3fdcf29cb"
            ]
        ]
    },
    {
        "id": "a7fa7bc3fdcf29cb",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation totale chauffage",
        "entityConfig": "6dbc88116a89ee2d",
        "version": 0,
        "state": "consototal",
        "stateType": "msg",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1890,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "f9c55eb38e63f82f",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 1 Chambre D'amis",
        "entityConfig": "76054f9f12d4abf5",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1650,
        "y": 1840,
        "wires": [
            []
        ]
    },
    {
        "id": "cf4a45632cea2d4d",
        "type": "comment",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "Renseigner les identifiants Intuis connect dans les parametres du NODE",
        "info": "Noeud Set Intuis Creds & Tokens\nrenseigner ClientId, ClientSecret, username et password dans les parametres node-red\n",
        "x": 330,
        "y": 60,
        "wires": []
    },
    {
        "id": "691e2058bd943c46",
        "type": "comment",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Pensez à créer les entitées à rattacher aux différents capteurs",
        "info": "",
        "x": 1720,
        "y": 1900,
        "wires": []
    },
    {
        "id": "19f864237658d884",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "Identifier les pièces",
        "rules": [
            {
                "t": "set",
                "p": "payload.rooms.0.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[0].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.0.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[0].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.1.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[1].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.1.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[1].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.2.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[2].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.2.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[2].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.3.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[3].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.3.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[3].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.4.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[4].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.4.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[4].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.5.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[5].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.5.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[5].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.6.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[6].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.6.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[6].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.7.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[7].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.7.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[7].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.8.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[8].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.8.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[8].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.9.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[9].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.9.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[9].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.10.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[10].name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.10.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[10].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.rooms.11.name",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[11].name",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.rooms.11.id",
                "pt": "msg",
                "to": "payload.body.homes[0].rooms[11].id",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1530,
        "y": 440,
        "wires": [
            [
                "a7cf91f7859e0c4a",
                "81b1bef51f82d97a"
            ]
        ]
    },
    {
        "id": "a7cf91f7859e0c4a",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Identifier les pièces",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.rooms",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1790,
        "y": 440,
        "wires": []
    },
    {
        "id": "4eb030f7e69e9077",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "définir global.home_id et home_name",
        "rules": [
            {
                "t": "set",
                "p": "home_id",
                "pt": "global",
                "to": "payload.body.homes[0].id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "home_name",
                "pt": "global",
                "to": "payload.body.homes[0].name",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1590,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "67ee9631179a9d0f",
        "type": "delay",
        "z": "a3667737564f7de1",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 620,
        "y": 700,
        "wires": [
            [
                "d9f2befaac2b726d",
                "6ebb80f837312213"
            ]
        ]
    },
    {
        "id": "a4df9b81c4858403",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Identification routeur",
        "func": "if (msg.payload.body.homes[0].modules[0].type === \"NMG\") {\n    msg.payload = msg.payload.body.homes[0].modules[0];\n    return msg;}\nelse if (msg.payload.body.homes[0].modules[1].type === \"NMG\") {\n    msg.payload = msg.payload.body.homes[0].modules[1];\n    return msg;}\nelse if (msg.payload.body.homes[0].modules[2].type === \"NMG\") {\n    msg.payload = msg.payload.body.homes[0].modules[2];\n    return msg;}\nelse if (msg.payload.body.homes[0].modules[3].type === \"NMG\") {\n    msg.payload = msg.payload.body.homes[0].modules[3];\n    return msg;}\nelse {msg.payload = \"ko\";\n    return msg;}\t \t ",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 620,
        "wires": [
            [
                "940fc48d0b83b26f"
            ]
        ]
    },
    {
        "id": "940fc48d0b83b26f",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "définir global routeur_id et routeur_name",
        "rules": [
            {
                "t": "set",
                "p": "routeur_id",
                "pt": "global",
                "to": "payload.id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "routeur_name",
                "pt": "global",
                "to": "payload.name",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1860,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "7ffa5b33183e8288",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "définir rooms_ids ",
        "rules": [
            {
                "t": "set",
                "p": "room0_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[0].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room1_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[1].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room2_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[2].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room3_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[3].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room4_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[4].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room5_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[5].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room6_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[6].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room7_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[7].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room8_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[8].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room9_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[9].id",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "room10_id",
                "pt": "global",
                "to": "payload.body.homes[0].rooms[10].id",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1530,
        "y": 500,
        "wires": [
            [
                "843cabbcfe2111e8"
            ]
        ]
    },
    {
        "id": "faac28666fd1e872",
        "type": "comment",
        "z": "a3667737564f7de1",
        "name": "A compléter selon nombre de pièces ",
        "info": "",
        "x": 2080,
        "y": 440,
        "wires": []
    },
    {
        "id": "86ab6bcc5d67d931",
        "type": "comment",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "A compléter selon nombre de pièces ",
        "info": "",
        "x": 940,
        "y": 1880,
        "wires": []
    },
    {
        "id": "4be6036fef820625",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "veille 12h01",
        "func": "var a = new Date();\na.setHours(12, 1, 0, 0); \na.setDate(a.getDate() - 1); \nvar b = a.getTime(); \nvar c = b / 1000; \n\n{\n    node.status({ fill: \"blue\", shape: \"ring\", text: c });\n    msg.debut = c;\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1940,
        "wires": [
            [
                "a4603047c37c9ccf"
            ]
        ]
    },
    {
        "id": "4a9277d1a6e0e4af",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "jour J 23h59",
        "func": "var d = new Date();\nvar e = d.setHours(23,59,59,0);\nvar f = e / 1000\n\n{\n    node.status({fill:\"blue\",shape:\"ring\", text:f});\n    msg.fin = f;\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 2000,
        "wires": [
            [
                "d1306ed7f8aac635"
            ]
        ]
    },
    {
        "id": "a4603047c37c9ccf",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "debut",
                "pt": "global",
                "to": "debut",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "d1306ed7f8aac635",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "fin",
                "pt": "global",
                "to": "fin",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "14c1c0ac41e49e9b",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "veille 00h00",
        "func": "var g = new Date();\ng.setDate(g.getDate() - 1);\nvar h = g.setHours(0,0,0,0);\nvar i = h / 1000;\n\n{\n    node.status({ fill: \"blue\", shape: \"ring\", text:i});  \n    msg.veille_debut = i;\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 2060,
        "wires": [
            [
                "379ab7ed0dd8c6fa"
            ]
        ]
    },
    {
        "id": "636d70287e18f7aa",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "veille 23h59",
        "func": "var j = new Date();\nj.setDate(j.getDate() - 1);\nvar k = j.setHours(23,59,59,0);\nvar l = k / 1000\n\n{\n    node.status({fill:\"blue\",shape:\"ring\", text:l});\n    msg.veille_fin = l;\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 2120,
        "wires": [
            [
                "8cf5423bdba99af6"
            ]
        ]
    },
    {
        "id": "379ab7ed0dd8c6fa",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "veille_debut",
                "pt": "global",
                "to": "veille_debut",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 2060,
        "wires": [
            []
        ]
    },
    {
        "id": "8cf5423bdba99af6",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "a7d0f6a353a3662f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "veille_fin",
                "pt": "global",
                "to": "veille_fin",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 2120,
        "wires": [
            []
        ]
    },
    {
        "id": "3967dc2dc34e149f",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "Set param get config 2 (jour J)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"date_end\": $globalContext(\"fin\"),\t  \"home\": {\t    \"id\": $globalContext(\"home_id\"),\t    \"rooms\": [\t      {\t        \"id\": $globalContext(\"room0_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room1_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room2_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room3_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room4_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room5_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room6_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room7_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room8_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room9_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room10_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      }\t    ]\t  },\t  \"app_identifier\": \"app_muller\",\t  \"date_begin\": $globalContext(\"debut\"),\t  \"scale\": \"1day\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 1840,
        "wires": [
            [
                "4e160860baa3b54c",
                "9394b4d8841f3020"
            ]
        ]
    },
    {
        "id": "4e160860baa3b54c",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "contrôle requête jour J",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 1840,
        "wires": []
    },
    {
        "id": "8150e047d1f38744",
        "type": "change",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Set param get config 2 (veille)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"date_end\": $globalContext(\"veille_fin\"),\t  \"home\": {\t    \"id\": $globalContext(\"home_id\"),\t    \"rooms\": [\t      {\t        \"id\": $globalContext(\"room0_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room1_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room2_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room3_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room4_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room5_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room6_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room7_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room8_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room9_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      },\t      {\t        \"id\": $globalContext(\"room10_id\"),\t        \"bridge\": $globalContext(\"routeur_id\"),\t        \"type\": \"sum_energy_elec$0\"\t      }\t    ]\t  },\t  \"app_identifier\": \"app_muller\",\t  \"date_begin\": $globalContext(\"veille_debut\"),\t  \"scale\": \"1day\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 1680,
        "wires": [
            [
                "b4f63770bf75b8f8",
                "9394b4d8841f3020"
            ]
        ]
    },
    {
        "id": "b4f63770bf75b8f8",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "contrôle requête veille",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 1680,
        "wires": []
    },
    {
        "id": "6ebb80f837312213",
        "type": "function",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "00h00 - 03h00",
        "func": "var now = new Date ();\nvar hours = now.getHours();\nvar minutes = now.getMinutes();\n\nif ((hours >= 0 && hours < 3) || (hours === 3 && minutes === 0)) {\n    node.status({fill:\"blue\",shape:\"ring\", text:\"après 00h et avant 03h\"});\n    return [msg, null]; // Sortie 1 \n} else { \n    node.status({fill:\"blue\",shape:\"ring\", text:\"après 03h et avant 00h\"});\n    return [null, msg]; // Sortie 2 \n}\n        ",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 1760,
        "wires": [
            [
                "8150e047d1f38744",
                "d644fd2ee03b6a57"
            ],
            [
                "b1b7e9ab80be7c43",
                "3967dc2dc34e149f"
            ]
        ]
    },
    {
        "id": "b1b7e9ab80be7c43",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "03h-00h",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 1800,
        "wires": []
    },
    {
        "id": "d644fd2ee03b6a57",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "00h-03h",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 1720,
        "wires": []
    },
    {
        "id": "114ba7eaf86e62aa",
        "type": "comment",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "A compléter selon nombre de pièces ",
        "info": "",
        "x": 940,
        "y": 1640,
        "wires": []
    },
    {
        "id": "4251a8325e8e8b29",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 6 Salon",
        "entityConfig": "cefcb67d6f9bc3da",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1620,
        "y": 2100,
        "wires": [
            []
        ]
    },
    {
        "id": "a6f06e0bc906d245",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 4 Couloir",
        "entityConfig": "8f644be40527e388",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1630,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "97133803606ca367",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 5 Toilettes Visiteurs",
        "entityConfig": "4b11554c2980b712",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1650,
        "y": 2040,
        "wires": [
            []
        ]
    },
    {
        "id": "81207d0f20f0bb98",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 3 Chambre Filles",
        "entityConfig": "5ae30bb9c36e011d",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1640,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "61c1cfb61f2fc6d7",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 2 Salle De Bain Filles",
        "entityConfig": "a8598d514ddc2992",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1650,
        "y": 1880,
        "wires": [
            []
        ]
    },
    {
        "id": "226fa24d299ae9b3",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 7 Salle à manger Cuisine",
        "entityConfig": "26429a74f02e051a",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1660,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "dc8e0139f295de61",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 10 Chambre Parents",
        "entityConfig": "69f87646ef646ef7",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1970,
        "y": 2020,
        "wires": [
            []
        ]
    },
    {
        "id": "a73ca7cd4c888e15",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 9 Cuisine",
        "entityConfig": "303c882f16d16f3f",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1950,
        "y": 1960,
        "wires": [
            []
        ]
    },
    {
        "id": "cce8bc8481c49e3f",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "52dda859303a9e7b",
        "name": "Consommation Room 8 Salle de bains Parents",
        "entityConfig": "9f31c4d71a2d6603",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].measures[0].value[0][0]",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1980,
        "y": 1900,
        "wires": [
            []
        ]
    },
    {
        "id": "843cabbcfe2111e8",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "function 1",
        "func": "msg.payload = {\n    room0_id: global.get(\"room0_id\"),\n    room1_id: global.get(\"room1_id\"),\n    room2_id: global.get(\"room2_id\"),\n    room3_id: global.get(\"room3_id\"),\n    room4_id: global.get(\"room4_id\"),\n    room5_id: global.get(\"room5_id\"),\n    room6_id: global.get(\"room6_id\"),\n    room7_id: global.get(\"room7_id\"),\n    room8_id: global.get(\"room8_id\"),\n    room9_id: global.get(\"room9_id\"),\n    room10_id: global.get(\"room10_id\"),\n    room11_id: global.get(\"room11_id\")\n};\nreturn msg;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 500,
        "wires": [
            [
                "84a7abe85ead2568"
            ]
        ]
    },
    {
        "id": "84a7abe85ead2568",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 500,
        "wires": []
    },
    {
        "id": "36a0cb2827584267",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Création ou maj des pièces dans HA",
        "func": "let rooms = msg.payload.body.homes[0].rooms;\nlet roomNames = {};\nlet options = [];\n\nfor (let i = 0; i < rooms.length; i++) {\n    let name = rooms[i].name;\n    let id = rooms[i].id;\n    options.push(name);\n    roomNames[name] = id;\n}\n\n// Sauvegarder pour plus tard\nglobal.set(\"room_name_to_id\", roomNames);\n\n// Envoyer les options à Home Assistant\nmsg.payload = {\n    entity_id: \"input_select.choix_piece1\",\n    options: options\n};\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 660,
        "wires": [
            [
                "c649f6b82a6c545c"
            ]
        ]
    },
    {
        "id": "c34398519cc2c89e",
        "type": "change",
        "z": "a3667737564f7de1",
        "name": "Identifier les plannings",
        "rules": [
            {
                "t": "set",
                "p": "payload.therm_schedules",
                "pt": "msg",
                "to": "payload.body.homes[0].therm_schedules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1800,
        "y": 380,
        "wires": [
            [
                "7033ac8c1bf74ae0",
                "7cfe4f7b8f4e8bcf",
                "publish_plannings_mqtt"
            ]
        ]
    },
    {
        "id": "7033ac8c1bf74ae0",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Liste des plannings",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 380,
        "wires": []
    },
    {
        "id": "2980cf284d68f799",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "name": "Mode fonctionnement Maison",
        "entityConfig": "6c0257c5859242a5",
        "version": 0,
        "state": "payload.body.homes[0].therm_mode",
        "stateType": "msg",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2450,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "7b3560f6d14a8682",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Mapping Etat",
        "func": "const mode = msg.payload.body.homes[0].therm_mode;\n\nconst mapping = {\n    \"hg\": \"Hors Gel\",\n    \"away\": \"Dehors\",\n    \"schedule\": \"Programmé\",\n    \"home\": \"Maison chauffée\"\n};\n\nmsg.payload.body.homes[0].therm_mode = mapping[mode] || \"inconnu\";\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 500,
        "wires": [
            [
                "2980cf284d68f799"
            ]
        ]
    },
    {
        "id": "d3d173a4ed73ae1b",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "1282f94706731784",
        "name": "debug 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 60,
        "wires": []
    },
    {
        "id": "8073b97687d0ad3a",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "liste pieces",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1920,
        "y": 660,
        "wires": []
    },
    {
        "id": "c649f6b82a6c545c",
        "type": "ha-update-config",
        "z": "a3667737564f7de1",
        "name": "Update liste de choix pièce",
        "server": "553a4a33f70c2e19",
        "entityConfig": "7b6075a0b55c0b0a",
        "version": 0,
        "outputProperties": [],
        "x": 1900,
        "y": 720,
        "wires": [
            [
                "8073b97687d0ad3a"
            ]
        ]
    },
    {
        "id": "7cfe4f7b8f4e8bcf",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Extrait les planififactions",
        "func": "// On récupère la liste des plannings\nconst plannings = msg.payload.body.homes[0].therm_schedules;\nconst outMsgs = [];\n\nfor (let i = 0; i < plannings.length; i++) {\n    const planning = plannings[i];\n    const entity_id = `input_text.therm_schedule_${planning.id}`;\n    const schedule_json = JSON.stringify(planning);\n\n    outMsgs.push({\n        payload: {\n            entity_id: entity_id,\n            value: schedule_json\n        }\n    });\n}\n\n// On sort un message par planning\nreturn [outMsgs];\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1950,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "3aa6fa713dbb01db",
        "type": "debug",
        "z": "a3667737564f7de1",
        "d": true,
        "name": "Traitement des plannings",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2850,
        "y": 60,
        "wires": []
    },
    {
        "id": "81b1bef51f82d97a",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Extrait les pièces",
        "func": "// Function Node en sortie de ton appel API\nconst home = msg.payload.body.homes[0].rooms;\nmsg.payload = {\n  entity_id: \"sensor.liste_pieces_lens\",\n  state: new Date().toISOString(),\n  attributes: {\n    raw_json: home     // la totalité de l’objet home\n  }\n};\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1910,
        "y": 140,
        "wires": [
            [
                "496d5cdfd9ade0d4",
                "d8c69b01d084111f"
            ]
        ]
    },
    {
        "id": "496d5cdfd9ade0d4",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Liste des pièces",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2180,
        "y": 120,
        "wires": []
    },
    {
        "id": "d8c69b01d084111f",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "name": "Liste Pièces",
        "entityConfig": "70c64959424002d3",
        "version": 0,
        "state": "payload.state",
        "stateType": "msg",
        "attributes": [
            {
                "property": "Attributes",
                "value": "payload.attributes",
                "valueType": "msg"
            }
        ],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2170,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "b755833499ad267f",
        "type": "http request",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Intuis homestatus",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/syncapi/v1/homestatus",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/x-www-form-urlencoded"
            }
        ],
        "x": 630,
        "y": 840,
        "wires": [
            [
                "277531f0ba1a6ea6",
                "48e07c183d26c4ab",
                "129f966a0f29d92a",
                "6fec4dfe0584cfb1",
                "531528e158634dab",
                "5956786c32542061",
                "c7c208fc104c4168",
                "26145049672b8fdd",
                "27405eacdabc8f66",
                "d128cae9b0e2cf45",
                "54c0d284f7d3bfe2",
                "28e41332c9d268ea",
                "1bbf4fe2031bc85b",
                "94df6c8058225842",
                "ad3eee4825b32a4b",
                "a12d496db209d907",
                "88e74568be0f092f",
                "fdd2becf2693b61c",
                "fbbe4368ed84a6c5",
                "99756c9d699f3239",
                "3857c28b8862d75c",
                "6c450f5bbf3d4c57",
                "021da8220fbc5550",
                "9abd987efd9b7546",
                "4cfd2835fa680165",
                "a0e9a9d273856931",
                "b91c58d27d54e5df",
                "0deb5c6d429f4ece",
                "9b94f09b171de499",
                "e141e4595a4b6e16",
                "384661809c003895",
                "bd3c37e931f40b40",
                "b8d10f455c93a148",
                "065ca84be94dbe41",
                "97e9f286fc9a5665",
                "36b119d798d1f09b",
                "5f97191c87be0997",
                "1a04b2760fa9722a",
                "402ca2eec0855371",
                "9be212ece344d070",
                "23ed5e92fa3e3e50",
                "08a6a40e838d1204",
                "c46e5b648a6e0f34",
                "974fedc8994ad3d2",
                "80d79edc3dcb6da3",
                "746d36e6ebe9c381",
                "91d09adf1e62589c",
                "ca91338c5feea99f",
                "b7cb94065f5b777b",
                "dc3f946f501c8c97",
                "6c100f59f14291b6",
                "db2894edb0520171",
                "7ddd3550788087fb",
                "d817b31516902f7c",
                "ecd8e9857be09e06",
                "5094e59c96a7f35e"
            ]
        ]
    },
    {
        "id": "277531f0ba1a6ea6",
        "type": "debug",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Intuis homestatus",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.body",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 820,
        "wires": []
    },
    {
        "id": "48e07c183d26c4ab",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Entrée",
        "entityConfig": "d95eedd859d8b664",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 960,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "a12d496db209d907",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Entrée",
        "entityConfig": "f76b635a04caa4af",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 990,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "129f966a0f29d92a",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Entrée",
        "entityConfig": "20256badf8bcbdd4",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 980,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "c7c208fc104c4168",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Entrée",
        "entityConfig": "c77c14d53889e40e",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 960,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "26145049672b8fdd",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Entrée",
        "entityConfig": "63d759f0f3c62f39",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3165697331\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 970,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "6fec4dfe0584cfb1",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Chambre d'amis",
        "entityConfig": "75bbd493b8d6cbaa",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 980,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "531528e158634dab",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Chambre D’amis",
        "entityConfig": "e3d9b4aa57e5eb2a",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1010,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "5956786c32542061",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Chambre D’amis",
        "entityConfig": "ae092069eb2baa8f",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1020,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "27405eacdabc8f66",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Chambre D’amis",
        "entityConfig": "8aa169c5137457b4",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 990,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "d128cae9b0e2cf45",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Chambre D’amis",
        "entityConfig": "2ad54ae8b6a0245a",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3330257038\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1000,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "54c0d284f7d3bfe2",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Salle De Bain Filles",
        "entityConfig": "1b0a97e23f63ce23",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2979072780\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1250,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "28e41332c9d268ea",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Salle De Bain Filles",
        "entityConfig": "100a313af5f252be",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2979072780\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1300,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "1bbf4fe2031bc85b",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Salle De Bain Filles",
        "entityConfig": "26eff76fdb9da3f4",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2979072780\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1270,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "94df6c8058225842",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Salle De Bain Filles",
        "entityConfig": "a2a9e05d6a0b1bca",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2979072780\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1250,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "ad3eee4825b32a4b",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Salle De Bain Filles",
        "entityConfig": "691179561d9ee5c9",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2979072780\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1260,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "6c100f59f14291b6",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Chambre Filles",
        "entityConfig": "d175ed0f639479c1",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1280,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "fdd2becf2693b61c",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Chambre Filles",
        "entityConfig": "4c0cfd77ea47deab",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1300,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "88e74568be0f092f",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Chambre Filles",
        "entityConfig": "98fab7910d34e3e3",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1300,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "fbbe4368ed84a6c5",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Chambre Filles",
        "entityConfig": "a25d545305d4095a",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1290,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "99756c9d699f3239",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Chambre Filles",
        "entityConfig": "eefcc8439123c565",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3957213003\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1290,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "6c450f5bbf3d4c57",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Couloir",
        "entityConfig": "e02b0c8d47c87143",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1600,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "021da8220fbc5550",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Couloir",
        "entityConfig": "7f7134e1363ea26a",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1600,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "9abd987efd9b7546",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Couloir",
        "entityConfig": "49266288c9a62c61",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1590,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "4cfd2835fa680165",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Couloir",
        "entityConfig": "049114a73bad92df",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1600,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "3857c28b8862d75c",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Couloir",
        "entityConfig": "cac4b902b0b84b30",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3807033309\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1580,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "b91c58d27d54e5df",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Toilettes Visiteurs",
        "entityConfig": "3f9bcd622b07c830",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1600,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "0deb5c6d429f4ece",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Toilettes Visiteurs",
        "entityConfig": "70c5705e81ca42f9",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1610,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "9b94f09b171de499",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Toilettes Visiteurs",
        "entityConfig": "1a58af4eea09dc8f",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1590,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "e141e4595a4b6e16",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Toilettes Visiteurs",
        "entityConfig": "5954d5ae6da7f5db",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1600,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "a0e9a9d273856931",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Toilettes Visiteurs",
        "entityConfig": "5d53e3559196a609",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3864339241\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1580,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "bd3c37e931f40b40",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Salle à manger",
        "entityConfig": "b7341bb3976a1367",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1920,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "b8d10f455c93a148",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Salle à manger",
        "entityConfig": "4980b75f18d30d53",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1890,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "065ca84be94dbe41",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Salle à manger",
        "entityConfig": "bb5a75a41d93970c",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1870,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "97e9f286fc9a5665",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Salle à manger",
        "entityConfig": "3773cd11fcbba532",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1880,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "384661809c003895",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Salle à manger",
        "entityConfig": "c5105ec09fee0f89",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3761003540\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1870,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "36b119d798d1f09b",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Cuisine",
        "entityConfig": "57fa319f12736dcf",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2260,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "5f97191c87be0997",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Cuisine",
        "entityConfig": "424bb978f0f6efde",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2280,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "1a04b2760fa9722a",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Cuisine",
        "entityConfig": "8db9b3e6402ad111",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2280,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "402ca2eec0855371",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Cuisine",
        "entityConfig": "f7a037d0631128ed",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2270,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "9be212ece344d070",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Cuisine",
        "entityConfig": "f879152761a06a35",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1668330398\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2280,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "08a6a40e838d1204",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Salle De Bain Parents",
        "entityConfig": "4b6005e3afbcf039",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2250,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "c46e5b648a6e0f34",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Salle De Bain Parents",
        "entityConfig": "489d1dba2e55caf0",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2220,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "974fedc8994ad3d2",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Salle De Bain Parents",
        "entityConfig": "818cb23a81c12045",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2200,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "80d79edc3dcb6da3",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Salle De Bain Parents",
        "entityConfig": "e2f6a2d30e54b216",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2210,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "23ed5e92fa3e3e50",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Salle De Bain Parents",
        "entityConfig": "53b332150a60514d",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"3357075329\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2190,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "91d09adf1e62589c",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Chambre Parents",
        "entityConfig": "b6ce81822e82d280",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2660,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "ca91338c5feea99f",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Chambre Parents",
        "entityConfig": "ccfe06e1f1664232",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2570,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "b7cb94065f5b777b",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Chambre Parents",
        "entityConfig": "03657b3c18adda23",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2550,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "dc3f946f501c8c97",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Chambre Parents",
        "entityConfig": "015c87b01e4d648f",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2560,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "746d36e6ebe9c381",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Chambre Parents",
        "entityConfig": "2091f2ca728b6769",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"1707740468\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 2540,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "db2894edb0520171",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température Salon",
        "entityConfig": "67699c44de8c3d4e",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].therm_measured_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1870,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "7ddd3550788087fb",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Mode fonctionnement Salon",
        "entityConfig": "27398167c586ce1e",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].therm_setpoint_mode",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1900,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "d817b31516902f7c",
        "type": "ha-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Température consigne Salon",
        "entityConfig": "34586545d535ffd6",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].therm_setpoint_temperature",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1900,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "ecd8e9857be09e06",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Fenêtre ouverte Salon",
        "entityConfig": "bdeef0ef5efb5cfc",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].open_window",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1880,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "5094e59c96a7f35e",
        "type": "ha-binary-sensor",
        "z": "a3667737564f7de1",
        "g": "b1d3bdb41aec61e1",
        "name": "Détection présence Salon",
        "entityConfig": "e5f43328f88b6b5d",
        "version": 0,
        "state": "$filter(payload.body.home.rooms, function($v){ $v.id = \"2064991252\" })[0].presence",
        "stateType": "jsonata",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 1890,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "publish_plannings_mqtt",
        "type": "function",
        "z": "a3667737564f7de1",
        "name": "Publier chaque planning MQTT",
        "func": "// Extrait tous les plannings de la réponse API et les publie chacun sur leur topic\nconst plannings = msg.payload.body.homes[0].therm_schedules;\nconst outMsgs = [];\nfor (let i = 0; i < plannings.length; i++) {\n    const planning = plannings[i];\n    const id = planning.id;\n    const topic = `plannings/therm_schedule_${id}`;\n    outMsgs.push({\n        topic: topic,\n        payload: JSON.stringify(planning),\n        retain: true,\n        from_sync: true\n    });\n}\nreturn [outMsgs];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 220,
        "wires": [
            [
                "e10e821b027b0d38",
                "mqtt_publish_planning"
            ]
        ]
    },
    {
        "id": "mqtt_publish_planning",
        "type": "mqtt out",
        "z": "a3667737564f7de1",
        "name": "MQTT publish planning",
        "topic": "",
        "qos": "0",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "b22e94a0f37cb076",
        "x": 2470,
        "y": 360,
        "wires": []
    },
    {
        "id": "mqtt_in_set",
        "type": "mqtt in",
        "z": "a3667737564f7de1",
        "d": true,
        "name": "MQTT IN /set",
        "topic": "plannings/+/set",
        "qos": "0",
        "datatype": "json",
        "broker": "b22e94a0f37cb076",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 2330,
        "y": 160,
        "wires": [
            [
                "miroir_set_to_root"
            ]
        ]
    },
    {
        "id": "miroir_set_to_root",
        "type": "function",
        "z": "a3667737564f7de1",
        "d": true,
        "name": "Miroir planning sur topic principal",
        "func": "// msg.topic ex: plannings/therm_schedule_xxx/set\nconst match = msg.topic.match(/^plannings\\/(therm_schedule_[^\\/]+)\\/set$/);\nif (!match) return null;\nconst rootTopic = `plannings/${match[1]}`;\n\n// payload = planning (normalement déjà JSON string)\nlet payload = msg.payload;\nif (typeof payload === \"string\") {\n    try { payload = JSON.parse(payload); } catch {}\n}\n\nreturn {\n    topic: rootTopic,\n    payload: JSON.stringify(payload),\n    retain: true\n};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2570,
        "y": 160,
        "wires": [
            [
                "f677676149cde246"
            ]
        ]
    },
    {
        "id": "e10e821b027b0d38",
        "type": "debug",
        "z": "a3667737564f7de1",
        "name": "Publication MQTT",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2410,
        "y": 300,
        "wires": []
    },
    {
        "id": "f677676149cde246",
        "type": "function",
        "z": "a3667737564f7de1",
        "d": true,
        "name": "Traite le planning",
        "func": "// Récupérer home_id & AccessToken depuis le contexte global\nconst home_id = global.get(\"home_id\");\nconst accessToken = global.get(\"AccessToken\");\nif (!home_id || !accessToken) {\n    node.warn(\"home_id ou AccessToken manquant !\");\n    return null;\n}\n\n// Détection du schedule_id : depuis topic ou payload\n// Extraction depuis topic : plannings/therm_schedule_xxx/set\nlet schedule_id = null;\nif (msg.topic) {\n    const match = msg.topic.match(/therm_schedule_([a-z0-9]+)/i);\n    if (match) schedule_id = match[1]; // <-- juste l'identifiant, sans \"therm_schedule_\"\n}\n\n// Extraction depuis le payload si jamais\nlet planning = msg.payload;\nif (typeof planning === \"string\") planning = JSON.parse(planning);\nif (!schedule_id && planning.id) {\n    schedule_id = planning.id.replace(/^therm_schedule_/, \"\"); // retire prefixe\n}\n\n// Sécurité :\nif (!schedule_id) {\n    node.warn(\"Impossible de déterminer schedule_id (ni dans topic ni dans payload)\");\n    return null;\n}\n\n// Formatage pour Intuis :\nmsg.payload = {\n    app_identifier: \"app_muller\",\n    home_id: home_id,\n    schedule_id: schedule_id,\n    zones: planning.zones,\n    timetable: planning.timetable,\n    hg_temp: planning.hg_temp,\n    away_temp: planning.away_temp\n};\n\nmsg.token = \"Bearer \" + accessToken;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2850,
        "y": 160,
        "wires": [
            [
                "3aa6fa713dbb01db"
            ]
        ]
    },
    {
        "id": "b9c90fe6a6374294",
        "type": "link in",
        "z": "a3667737564f7de1",
        "name": "link in 1",
        "links": [
            "c6c6dc2710f6bed2"
        ],
        "x": 225,
        "y": 380,
        "wires": [
            [
                "0b708dd99a7fdecb"
            ]
        ]
    },
    {
        "id": "b74d1c79eb438825",
        "type": "debug",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "contrôle retour",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1660,
        "y": 220,
        "wires": []
    },
    {
        "id": "0f7a3a023a851828",
        "type": "debug",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "contrôle requête",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1460,
        "y": 160,
        "wires": []
    },
    {
        "id": "1c0e78ec8f4d02d1",
        "type": "http request",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Intuis setstate",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/syncapi/v1/setstate",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1460,
        "y": 220,
        "wires": [
            [
                "b74d1c79eb438825"
            ]
        ]
    },
    {
        "id": "d6c83735e0426191",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Set param acquit fenetre",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t    \"home\": {\t        \"id\": $globalContext(\"home_id\"),\t        \"rooms\": [\t            {\t                \"id\": $globalContext(\"room_name_to_id\"),\t                \"therm_setpoint_mode\": $globalContext(\"mode_setpoint\"),\t                \"therm_setpoint_temperature\": $globalContext(\"temp_setpoint\"),\t                \"therm_setpoint_end_time\": $globalContext(\"due_date_setpoint\")\t            }\t        ]\t    }\t}\t\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1210,
        "y": 220,
        "wires": [
            [
                "0f7a3a023a851828",
                "1c0e78ec8f4d02d1"
            ]
        ]
    },
    {
        "id": "5e47cb03882a592c",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 220,
        "wires": [
            [
                "d6c83735e0426191"
            ]
        ]
    },
    {
        "id": "3f4d9b89505b1553",
        "type": "server-state-changed",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Mode de fonctionnement - setpoint",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.radiateur_chambre_parents_mode_de_fonctionnement_setpoint"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 220,
        "y": 220,
        "wires": [
            [
                "d3f176bc44a4f1f9"
            ]
        ]
    },
    {
        "id": "54af251f4a00845b",
        "type": "server-state-changed",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Consigne de température - setpoint",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.radiateur_chambre_parents_consigne_de_temperature_setpoint"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 220,
        "y": 160,
        "wires": [
            [
                "e99f423457b936f2"
            ]
        ]
    },
    {
        "id": "e99f423457b936f2",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "temp_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 160,
        "wires": [
            [
                "cbbb5d8f83363d0d"
            ]
        ]
    },
    {
        "id": "7e1576fb3de95fcc",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "due_date_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 280,
        "wires": [
            [
                "cbbb5d8f83363d0d"
            ]
        ]
    },
    {
        "id": "d3f176bc44a4f1f9",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "mode_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 220,
        "wires": [
            [
                "cbbb5d8f83363d0d"
            ]
        ]
    },
    {
        "id": "cbbb5d8f83363d0d",
        "type": "delay",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 770,
        "y": 220,
        "wires": [
            [
                "5e47cb03882a592c"
            ]
        ]
    },
    {
        "id": "cdb9f005b0bb8fe8",
        "type": "server-state-changed",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Echéance - setpoint",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_datetime.radiateur_chambre_parents_setpoint_end_time"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 170,
        "y": 280,
        "wires": [
            [
                "412c26a5faa47c42"
            ]
        ]
    },
    {
        "id": "e34dc2fbdc702765",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$round($number($toMillis(payload))/1000,0)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 280,
        "wires": [
            [
                "7e1576fb3de95fcc"
            ]
        ]
    },
    {
        "id": "412c26a5faa47c42",
        "type": "moment",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "Europe/Paris",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "C",
        "output": "payload",
        "outputType": "msg",
        "outTz": "Europe/Paris",
        "x": 400,
        "y": 280,
        "wires": [
            [
                "e34dc2fbdc702765"
            ]
        ]
    },
    {
        "id": "6793e71a455b8fa2",
        "type": "server-state-changed",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "Ecoute Choix pièce",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.choix_piece"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "entity",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 170,
        "y": 340,
        "wires": [
            [
                "de012e4ff5a1ae1a"
            ]
        ]
    },
    {
        "id": "de012e4ff5a1ae1a",
        "type": "function",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "function 2",
        "func": "let selectedRoomName = msg.payload;  // par défaut c'est juste le nom de la pièce sélectionnée\nlet map = global.get(\"room_name_to_id\") || {};\n\nlet roomId = map[selectedRoomName];\n\nif (!roomId) {\n    node.warn(`Nom de pièce non trouvé dans la map: ${selectedRoomName}`);\n    return null;\n}\n\nmsg.payload = roomId;  // l'ID de la pièce qu'on pourra utiliser ensuite\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 340,
        "wires": [
            [
                "8b664aded0ec9d14",
                "a7f924b6389d4e84"
            ]
        ]
    },
    {
        "id": "8b664aded0ec9d14",
        "type": "debug",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 420,
        "wires": []
    },
    {
        "id": "a7f924b6389d4e84",
        "type": "change",
        "z": "41f803cead1de025",
        "g": "98f6607d60aa2973",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "room_name_to_id",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 340,
        "wires": [
            [
                "cbbb5d8f83363d0d"
            ]
        ]
    },
    {
        "id": "e16b1440f9976fc9",
        "type": "debug",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "contrôle retour",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1900,
        "y": 140,
        "wires": []
    },
    {
        "id": "40443890d8c3a7df",
        "type": "debug",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "contrôle requête",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1700,
        "y": 80,
        "wires": []
    },
    {
        "id": "5a3259d752e1efa7",
        "type": "http request",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Intuis setstate",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/setthermmode",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1700,
        "y": 140,
        "wires": [
            [
                "e16b1440f9976fc9"
            ]
        ]
    },
    {
        "id": "2ae8f33d83a59f91",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Set home mode",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"app_identifier\": \"app_muller\",\t  \"home_id\": $globalContext(\"home_id\"),\t  \"mode\": $globalContext(\"mode_setpoint\"),\t  \"endtime\": $globalContext(\"due_date_setpoint\")\t}\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 140,
        "wires": [
            [
                "40443890d8c3a7df",
                "5a3259d752e1efa7"
            ]
        ]
    },
    {
        "id": "f1b88b07dab52fdf",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1290,
        "y": 140,
        "wires": [
            [
                "2ae8f33d83a59f91"
            ]
        ]
    },
    {
        "id": "e0f695c83e952ca1",
        "type": "server-state-changed",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Home mode selected",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.radiateurs_intuis_set_mode"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 140,
        "y": 140,
        "wires": [
            [
                "481383c692b73536"
            ]
        ]
    },
    {
        "id": "f81677b3ca6fc19f",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "due_date_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 200,
        "wires": [
            [
                "1374093addec990d"
            ]
        ]
    },
    {
        "id": "e4342b0432a85d74",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "mode_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 140,
        "wires": [
            [
                "96c2c3ef618edd31"
            ]
        ]
    },
    {
        "id": "96c2c3ef618edd31",
        "type": "delay",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1090,
        "y": 140,
        "wires": [
            [
                "f1b88b07dab52fdf"
            ]
        ]
    },
    {
        "id": "1267ba1a01763541",
        "type": "server-state-changed",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Due date selected",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_datetime.away_until_date"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 130,
        "y": 200,
        "wires": [
            [
                "4a1da8ae2657e4f7"
            ]
        ]
    },
    {
        "id": "be6618e22ddd3bef",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$round($number($toMillis(payload))/1000,0)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 200,
        "wires": [
            [
                "f81677b3ca6fc19f"
            ]
        ]
    },
    {
        "id": "4a1da8ae2657e4f7",
        "type": "moment",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "Europe/Paris",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "C",
        "output": "payload",
        "outputType": "msg",
        "outTz": "Europe/Paris",
        "x": 360,
        "y": 200,
        "wires": [
            [
                "be6618e22ddd3bef"
            ]
        ]
    },
    {
        "id": "481383c692b73536",
        "type": "function",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Transco home mode",
        "func": "if(msg.payload == \"Home\")\n{\n    msg.payload = \"schedule\";\n}\nelse if (msg.payload == \"Away\")\n{\n    msg.payload = \"away\";\n}\nelse if ( msg.payload == \"Hors Gel\")\n{\n    msg.payload = \"hg\";\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 140,
        "wires": [
            [
                "e4342b0432a85d74"
            ]
        ]
    },
    {
        "id": "1374093addec990d",
        "type": "function",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Modifie endpoint à null si dans le passé",
        "func": "const endtime = global.get(\"due_date_setpoint\"); // timestamp attendu en secondes\n\nconst now = Math.floor(Date.now() / 1000);\nconst minTime = now + 5 * 60;\nconst maxTime = now + 365 * 24 * 60 * 60;\n\nlet validEndtime = null;\n\n// Vérifie si endtime est dans la plage valide\nif (endtime >= minTime && endtime <= maxTime) {\n    validEndtime = endtime;\n}\n\n// Si endtime est invalide ET le mode est \"manual\", alors on met une durée par défaut\nif (validEndtime === null && global.get(\"mode_setpoint\") === \"manual\") {\n    validEndtime = now + 60 * 60 * 3; // 3 heures à partir de maintenant\n}\n\n// On met à jour la valeur globale avec la nouvelle valeur (valide ou fallback)\nglobal.set(\"due_date_setpoint\", validEndtime);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 200,
        "wires": [
            [
                "96c2c3ef618edd31"
            ]
        ]
    },
    {
        "id": "63ac1cb9b44f06e5",
        "type": "change",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "home_temp_setpoint",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 80,
        "wires": [
            [
                "96c2c3ef618edd31"
            ]
        ]
    },
    {
        "id": "0cc9f801b39f1091",
        "type": "server-state-changed",
        "z": "e246d4c0642ebf59",
        "g": "087481a66b64a77c",
        "name": "Consigne de température - setpoint",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.radiateurs_consigne_de_temperature_setpoint"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 180,
        "y": 80,
        "wires": [
            [
                "63ac1cb9b44f06e5"
            ]
        ]
    },
    {
        "id": "b33a88b5617f89db",
        "type": "server-state-changed",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Etat planning 1",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.planning_chauffage"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": true,
        "stateType": "str",
        "ifState": "A La Maison Haut",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "1",
                "valueType": "num"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "timestamp",
                "propertyType": "msg",
                "value": "",
                "valueType": "date"
            }
        ],
        "x": 180,
        "y": 140,
        "wires": [
            [
                "5e86c83b1bb1779e"
            ],
            []
        ]
    },
    {
        "id": "fd042da8b632b8ba",
        "type": "server-state-changed",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Etat planning 2",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.planning_chauffage"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": true,
        "stateType": "str",
        "ifState": "A La Maison Toutes Pièces",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "1",
                "valueType": "num"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "timestamp",
                "propertyType": "msg",
                "value": "",
                "valueType": "date"
            }
        ],
        "x": 180,
        "y": 240,
        "wires": [
            [
                "92400dcaf72c9972"
            ],
            []
        ]
    },
    {
        "id": "5e86c83b1bb1779e",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 120,
        "wires": [
            [
                "9c57574987b74339"
            ]
        ]
    },
    {
        "id": "92400dcaf72c9972",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 240,
        "wires": [
            [
                "d46ec09d2328154d"
            ]
        ]
    },
    {
        "id": "9c57574987b74339",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Set param planning 1",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"app_identifier\" : \"app_muller\",\t  \"home_id\" : $globalContext(\"home_id\"),\t  \"schedule_id\" : \"68027f6edf45595014072b64\",\t  \"schedule_type\" : \"therm\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 120,
        "wires": [
            [
                "3ad8fc0b452f4caa",
                "aa959dcd5b04c60c"
            ]
        ]
    },
    {
        "id": "d46ec09d2328154d",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Set param planning 2",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"app_identifier\" : \"app_muller\",\t  \"home_id\" : $globalContext(\"home_id\"),\t  \"schedule_id\" : \"6802848e417f5ad56e0b7606\",\t  \"schedule_type\" : \"therm\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 240,
        "wires": [
            [
                "cbef5337b3ef3900",
                "aa959dcd5b04c60c"
            ]
        ]
    },
    {
        "id": "3ad8fc0b452f4caa",
        "type": "http request",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Intuis switchhomeschedule",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/switchhomeschedule",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1040,
        "y": 120,
        "wires": [
            [
                "471d58b1750acfda"
            ]
        ]
    },
    {
        "id": "cbef5337b3ef3900",
        "type": "http request",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Intuis switchhomeschedule",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/switchhomeschedule",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1040,
        "y": 240,
        "wires": [
            [
                "471d58b1750acfda"
            ]
        ]
    },
    {
        "id": "471d58b1750acfda",
        "type": "debug",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "contrôle retour",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 180,
        "wires": []
    },
    {
        "id": "58aee8436820190c",
        "type": "server-state-changed",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "Etat bouton acquitter ",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_button.ack_windows_open"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "1",
                "valueType": "num"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "timestamp",
                "propertyType": "msg",
                "value": "",
                "valueType": "date"
            }
        ],
        "x": 150,
        "y": 420,
        "wires": [
            [
                "1886bcc7c5f82bc7"
            ]
        ]
    },
    {
        "id": "1886bcc7c5f82bc7",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 420,
        "wires": [
            [
                "523fe5db69368821"
            ]
        ]
    },
    {
        "id": "523fe5db69368821",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "Set param acquit fenetre",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"home\": {\t    \"id\": $globalContext(\"home_id\"),\t    \"rooms\": [\t      {\t        \"id\": $globalContext(\"room0_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room1_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room2_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room3_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room4_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room5_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room6_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room7_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room8_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room9_id\"),\t        \"open_window\": false\t      },\t      {\t        \"id\": $globalContext(\"room10_id\"),\t        \"open_window\": false\t      }\t    ]\t  },\t  \"app_identifier\": \"app_muller\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 420,
        "wires": [
            [
                "c2967d79d0c0fe33",
                "b57531cff61def7e"
            ]
        ]
    },
    {
        "id": "1afb356e7d76cfe1",
        "type": "debug",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "contrôle retour",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1340,
        "y": 420,
        "wires": []
    },
    {
        "id": "c2967d79d0c0fe33",
        "type": "debug",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "contrôle requête",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 360,
        "wires": []
    },
    {
        "id": "f24589a6a83bd139",
        "type": "inject",
        "z": "9794645f52fb9ea3",
        "d": true,
        "g": "9c29a7df43721672",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 360,
        "wires": [
            [
                "1886bcc7c5f82bc7"
            ]
        ]
    },
    {
        "id": "b57531cff61def7e",
        "type": "http request",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "Intuis setstate",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/syncapi/v1/setstate",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1020,
        "y": 420,
        "wires": [
            [
                "1afb356e7d76cfe1"
            ]
        ]
    },
    {
        "id": "949dc9bc2d0e3620",
        "type": "comment",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "A compléter ... ",
        "info": "Renseigner votre serveur\nPuis ajouter une entitée \nEn cliquant sur + add entity",
        "x": 170,
        "y": 480,
        "wires": []
    },
    {
        "id": "8c8d32bea621bca5",
        "type": "comment",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "A compléter ... ",
        "info": "Renseigner votre serveur\nPuis ajouter une entitée \nen cliquant sur + add entity\nPuis renseigner le libellé de votre planning\nà la place de \"libellé_planning_\" 1 ou 2",
        "x": 190,
        "y": 200,
        "wires": []
    },
    {
        "id": "d83a9dc535b855e4",
        "type": "comment",
        "z": "9794645f52fb9ea3",
        "g": "9c29a7df43721672",
        "name": "A compléter selon nombre de pièces ",
        "info": "",
        "x": 740,
        "y": 460,
        "wires": []
    },
    {
        "id": "959a7bbf9fba0ac5",
        "type": "comment",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "A compléter avec les id de planning",
        "info": "",
        "x": 720,
        "y": 180,
        "wires": []
    },
    {
        "id": "aa959dcd5b04c60c",
        "type": "debug",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "contrôle requête",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 180,
        "wires": []
    },
    {
        "id": "b110bb4941c45514",
        "type": "server-state-changed",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Etat planning 3",
        "server": "553a4a33f70c2e19",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.planning_chauffage"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": true,
        "stateType": "str",
        "ifState": "Default",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "1",
                "valueType": "num"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "timestamp",
                "propertyType": "msg",
                "value": "",
                "valueType": "date"
            }
        ],
        "x": 180,
        "y": 280,
        "wires": [
            [
                "d3b45a549e9deaf2"
            ],
            []
        ]
    },
    {
        "id": "d3b45a549e9deaf2",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "token",
                "pt": "msg",
                "to": "\"Bearer \" & $globalContext(\"AccessToken\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 280,
        "wires": [
            [
                "cb09a5af2ccab0ae"
            ]
        ]
    },
    {
        "id": "cb09a5af2ccab0ae",
        "type": "change",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Set param planning 3",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t  \"app_identifier\" : \"app_muller\",\t  \"home_id\" : $globalContext(\"home_id\"),\t  \"schedule_id\" : \"68026a1b7db42082e6059463\",\t  \"schedule_type\" : \"therm\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 280,
        "wires": [
            [
                "c540264fb7957f40",
                "aa959dcd5b04c60c"
            ]
        ]
    },
    {
        "id": "c540264fb7957f40",
        "type": "http request",
        "z": "9794645f52fb9ea3",
        "g": "34336a48ec02f20d",
        "name": "Intuis switchhomeschedule",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/switchhomeschedule",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1040,
        "y": 280,
        "wires": [
            [
                "471d58b1750acfda"
            ]
        ]
    },
    {
        "id": "a76915034b861984",
        "type": "http request",
        "z": "d6bbc06b7594e446",
        "name": "Intuis synchomeschedule",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://app.muller-intuitiv.net/api/synchomeschedule",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "msg",
                "valueValue": "token"
            },
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1030,
        "y": 420,
        "wires": [
            [
                "cecf2503d6f0b63c",
                "c6c6dc2710f6bed2",
                "mqtt_feedback_function"
            ]
        ]
    },
    {
        "id": "cecf2503d6f0b63c",
        "type": "debug",
        "z": "d6bbc06b7594e446",
        "name": "Retour Intuis",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 520,
        "wires": []
    },
    {
        "id": "edeaa6d312717d17",
        "type": "mqtt in",
        "z": "d6bbc06b7594e446",
        "name": "MQTT IN principal",
        "topic": "plannings/+",
        "qos": "0",
        "datatype": "json",
        "broker": "b22e94a0f37cb076",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 110,
        "y": 340,
        "wires": [
            [
                "af717cae36828fa7"
            ]
        ]
    },
    {
        "id": "21f4bbc090bc211f",
        "type": "mqtt in",
        "z": "d6bbc06b7594e446",
        "name": "MQTT IN /set",
        "topic": "plannings/+/set",
        "qos": "0",
        "datatype": "json",
        "broker": "b22e94a0f37cb076",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 90,
        "y": 420,
        "wires": [
            [
                "b12a4290fd5eeb38"
            ]
        ]
    },
    {
        "id": "b12a4290fd5eeb38",
        "type": "change",
        "z": "d6bbc06b7594e446",
        "name": "Extrait schedule_id + get main",
        "rules": [
            {
                "t": "set",
                "p": "schedule_id",
                "pt": "msg",
                "to": "$match(topic, /^plannings\\/(therm_schedule_[^/]+)\\/set$/).groups[1]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "main",
                "pt": "msg",
                "to": "$flowContext('planning_' & schedule_id)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 420,
        "wires": [
            [
                "3c51578bbcbdb9d6"
            ]
        ]
    },
    {
        "id": "3c51578bbcbdb9d6",
        "type": "function",
        "z": "d6bbc06b7594e446",
        "name": "Diff ? (si oui, prépare payload Intuis)",
        "func": "if (global.get('refreshing')) {\n    node.warn(\"En mode refresh global : pas de diff, pas d’envoi à Intuis\");\n    return null;\n}\n\n// Vérifie le topic /set reçu\nconst home_id = global.get(\"home_id\");\nconst accessToken = global.get(\"AccessToken\");\n//node.warn(\"MSG TOPIC: \" + msg.topic);\nlet m = msg.topic.match(/^plannings\\/(therm_schedule_[^\\/]+)\\/set$/);\nif (!m || !m[1]) {\n   // node.warn('Pas de match schedule_id');\n    return null;\n}\nlet schedule_id = m[1];\n\n// Va chercher le main depuis le contexte flow (déjà stocké par l’autre flow !)\nlet main = flow.get('planning_' + schedule_id);\nif (!main) {\n    //node.warn(\"Aucun planning principal en mémoire pour ce schedule_id\");\n    return null;\n}\n\nif (typeof main === \"string\") { try { main = JSON.parse(main); } catch {} }\nif (typeof msg.payload === \"string\") { try { msg.payload = JSON.parse(msg.payload); } catch {} }\n\n// Compare uniquement les parties importantes\nfunction relevant(obj) {\n    return {\n        timetable: obj.timetable,\n        zones: obj.zones,\n        away_temp: obj.away_temp,\n        hg_temp: obj.hg_temp\n    };\n}\nfunction planningname(obj1) {\n    return  {\n        name: obj1.name\n    }\n}\nlet oldname = planningname(main);\nlet old = relevant(main);\nlet now = relevant(msg.payload);\n\nif (JSON.stringify(old) === JSON.stringify(now)) {\n    // node.warn(\"Aucune différence, rien à envoyer à Intuis\");\n    return null;\n}\n\n// Si on arrive ici, il y a une vraie diff !\n// node.warn(\"DIFF détectée, envoi à Intuis !\");\nmsg.payload = {\n    app_identifier: \"app_muller\",\n    home_id: home_id,\n    schedule_id: schedule_id.replace(/^therm_schedule_/, \"\"),\n    name: oldname.name,\n    timetable: now.timetable,\n    zones: now.zones,\n    away_temp: now.away_temp,\n    hg_temp: now.hg_temp\n};\nmsg.token = \"Bearer \" + accessToken;\nmsg.schedule_id = schedule_id;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 420,
        "wires": [
            [
                "6ab88511875cc3b9",
                "a76915034b861984"
            ]
        ]
    },
    {
        "id": "6ab88511875cc3b9",
        "type": "debug",
        "z": "d6bbc06b7594e446",
        "name": "Diff debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 280,
        "wires": []
    },
    {
        "id": "b82c6763d579d537",
        "type": "debug",
        "z": "d6bbc06b7594e446",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1520,
        "y": 520,
        "wires": []
    },
    {
        "id": "529cb5ec4f9e20c0",
        "type": "function",
        "z": "d6bbc06b7594e446",
        "name": "Save main schedule",
        "func": "//node.warn(\"MSG TOPIC: \" + msg.topic); // Affiche le topic exact reçu\nif(msg.topic){\n    let m = msg.topic.match(/^plannings\\/(therm_schedule_[^/]+)$/);\n   // node.warn(\"REGEX: \" + JSON.stringify(m));\n    if(m && m[1]) {\n        msg.schedule_id = m[1];\n        flow.set('planning_' + msg.schedule_id, msg.payload);\n     //   node.warn('Stocké: planning_' + msg.schedule_id);\n    } else {\n        node.warn('Pas de match schedule_id');\n    }\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c6c6dc2710f6bed2",
        "type": "link out",
        "z": "d6bbc06b7594e446",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "b9c90fe6a6374294"
        ],
        "x": 1195,
        "y": 340,
        "wires": []
    },
    {
        "id": "mqtt_feedback_function",
        "type": "function",
        "z": "d6bbc06b7594e446",
        "name": "Publier feedback planning",
        "func": "// Essaie de trouver le schedule_id à tous les endroits possibles\nlet planning_id =\n    msg.schedule_id ||\n    (msg.payload && msg.payload.schedule_id) ||\n    (msg.payload && msg.payload.body && msg.payload.body.schedule_id) ||\n    \"unk\";\n\n// Si l’API t’a renvoyé le planning avec id sans le \"therm_schedule_\" devant, ajoute-le ici si besoin\nif (!planning_id.startsWith(\"therm_schedule_\") && planning_id.length > 15) {\n    planning_id = \"therm_schedule_\" + planning_id;\n}\n\nconst topic = `plannings/result_${planning_id}`;\n\n// Statut = succès si le retour API a .success, sinon true par défaut (adapte à ta structure)\nlet status = true;\nlet apiMsg = \"\";\n\n// Vérifie s'il y a une erreur format Intuis\nif (typeof msg.payload === \"object\") {\n    // Cas API Intuis avec .error\n    if (msg.payload.error) {\n        status = false;\n        apiMsg = msg.payload.error.message || JSON.stringify(msg.payload.error);\n    }\n    // Cas success flag explicite\n    else if (msg.payload.success === false) {\n        status = false;\n        apiMsg = msg.payload.message || msg.payload.error || \"\";\n    } else if (typeof msg.payload.success === \"boolean\") {\n        status = !!msg.payload.success;\n        apiMsg = msg.payload.message || \"\";\n    }\n}\n\n// Option fallback si tu as d’autres flags d’erreur\nif (typeof msg.api_ok !== \"undefined\") status = !!msg.api_ok;\nif (typeof msg.api_err_msg === \"string\" && msg.api_err_msg) apiMsg = msg.api_err_msg;\n\nconst message = status\n    ? \"Planning injecté avec succès.\"\n    : \"Erreur : \" + (apiMsg || \"API inconnue\");\n\nreturn {\n    topic: topic,\n    payload: JSON.stringify({\n        ok: status,\n        message: message,\n        id: planning_id,\n        timestamp: Math.floor(Date.now() / 1000)\n    }),\n    retain: false\n};\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 420,
        "wires": [
            [
                "mqtt_publish_feedback",
                "b82c6763d579d537"
            ]
        ]
    },
    {
        "id": "mqtt_publish_feedback",
        "type": "mqtt out",
        "z": "d6bbc06b7594e446",
        "name": "MQTT publish feedback",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "b22e94a0f37cb076",
        "x": 1550,
        "y": 420,
        "wires": []
    },
    {
        "id": "af717cae36828fa7",
        "type": "function",
        "z": "d6bbc06b7594e446",
        "name": "Filtre les result_",
        "func": "// Node \"function\"\nif (msg.topic && msg.topic.startsWith(\"plannings/result_\")) {\n    // On ignore les messages de feedback\n    return null;\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 340,
        "wires": [
            [
                "529cb5ec4f9e20c0"
            ]
        ]
    }
]
